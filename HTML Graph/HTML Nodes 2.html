<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Network Diagram from CSV</title>
    <style>
        #mynetwork {
            width: 100%;
            height: 600px;
            border: 1px solid lightgray;
        }
    </style>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.16.0/d3.min.js"></script>
</head>
<body>
    <h1>Network Diagram from CSV</h1>
    <div id="mynetwork"></div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Function to parse CSV data
            function parseCSV(csvData) {
                const rows = csvData.split('\n');
                const headers = rows[0].split(',');
                const edges = [];
                const nodesMap = new Map();

                rows.slice(1).forEach(row => {
                    const data = row.split(',');
                    const itemID = data[headers.indexOf('itemID')].trim();
                    const dependency = data[headers.indexOf('dependency')].trim();
                    
                    if (itemID && dependency) {
                        edges.push({ from: itemID, to: dependency });

                        if (!nodesMap.has(itemID)) {
                            nodesMap.set(itemID, { id: itemID, label: itemID, title: createTooltip(data, headers) });
                        }
                        if (!nodesMap.has(dependency)) {
                            nodesMap.set(dependency, { id: dependency, label: dependency, title: createTooltip(data, headers) });
                        }
                    }
                });

                const nodes = Array.from(nodesMap.values());
                return { nodes, edges };
            }

            // Function to create a tooltip content
            function createTooltip(data, headers) {
                return headers.map((header, index) => `<strong>${header}:</strong> ${data[index]}`).join('<br>');
            }

            // Function to draw the network
            function drawNetwork(data) {
                const container = document.getElementById('mynetwork');
                const nodes = new vis.DataSet(data.nodes);
                const edges = new vis.DataSet(data.edges);
                const networkData = { nodes, edges };
                const options = {
                    nodes: {
                        shape: 'dot',
                        size: 10,
                        font: {
                            size: 14,
                            face: 'Tahoma'
                        },
                        borderWidth: 2
                    },
                    interaction: {
                        tooltipDelay: 200,
                        hover: true
                    },
                    physics: {
                        enabled: true,
                        stabilization: {
                            iterations: 250
                        }
                    }
                };
                const network = new vis.Network(container, networkData, options);

                // Log hover events to console for debugging
                network.on("hoverNode", function (params) {
                    console.log("hoverNode Event:", params);
                });

                // Log showPopup events to console for debugging
                network.on("showPopup", function (params) {
                    console.log("showPopup Event:", params);
                });
            }

            // Fetch and parse the CSV file, then draw the network
            d3.csv('test.csv').then(data => {
                const parsedData = parseCSV(d3.csvFormat(data));
                drawNetwork(parsedData);
            }).catch(error => {
                console.error('Error loading or parsing CSV file:', error);
            });
        });
    </script>
</body>
</html>
